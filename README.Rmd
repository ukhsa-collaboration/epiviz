---
title: "epiviz: Easy Epidemiological Data Visualisation for R"
output:
  html_document:
    theme: cosmo
---

# epiviz <img src="man/figures/logo.png" align="right" height="139" alt="" />

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![R-CMD-check](https://github.com/ukhsa-collaboration/epiviz/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/ukhsa-collaboration/epiviz/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

`epiviz` provides easy-to-use data visualisation functions for R epidemiological data science products. The package includes functions to create a range of static and interactive visualisations. Each visualisation function can produce either a static (ggplot2) or dynamic (plotly/leaflet) output using the same set of parameters, allowing users to easily switch between visualisation types by simply changing the `dynamic` flag.

## Installation

epiviz can be installed from GitHub using the following code.
```r
remotes::install_github('ukhsa-collaboration/epiviz')

# To install the development version
remotes::install_github("ukhsa-collaboration/epiviz@dev")
``` 

## Features

The following visualisation functions are available in the current release of epiviz:

- `line_chart()`: Line chart with options to add dual axes, threshold lines, and confidence limits as ribbons/error bars.
- `col_chart()`: Column chart with options to add dual axes, threshold lines, and confidence limits as ribbons/error bars.
- `point_chart()`: Point chart with support for groups, labels, and optional confidence intervals.
- `epi_curve()`: Epidemic curve with flexible time aggregation, grouped bars, optional rolling averages, and a cumulative line.
- `epi_map()`: Epidemiological map with customisable maps adaptable for multiple administrative levels.
- `age_sex_pyramid()`: Age-sex pyramid with customisable age bands with the option to add error bars.
- `llm_interpret()` (experimental): Generate brief narrative interpretations of data frames or ggplot outputs using configured LLMs.

## Package data

epiviz includes an anonymised sample dataset from the SGSS laboratory database: `lab_data()`

The Second Generation Surveillance System (SGSS) is a data asset held by the [UK Health Security Agency](https://www.gov.uk/government/publications/securing-our-health-the-uk-health-security-agency/securing-our-health-the-uk-health-security-agency) (formerly Public Health England) which routinely and automatically collects laboratory data from across England.

Laboratories return data on organisms isolated from samples such as the organism species, specimen type, sampling date and antimicrobial susceptibility testing results. These data are routinely used for public health surveillance and epidemiology in England.

## Examples

### Line Chart
```r
# Create a static line chart
line_chart(
  dynamic = FALSE,
  params = list(
    df = summarised_df,
    x = "specimen_date",
    y = "count",
    group_var = "organism_species_name",
    line_colour = c("blue", "green", "orange"),
    line_type = c("solid", "dotted", "dashed")
  )
)

# Convert to an interactive plotly chart by changing dynamic to TRUE
line_chart(
  dynamic = TRUE,
  params = list(
    df = summarised_df,
    x = "specimen_date",
    y = "count",
    group_var = "organism_species_name",
    line_colour = c("blue", "green", "orange"),
    line_type = c("solid", "dotted", "dashed")
  )
)
```

### Age-Sex Pyramid
```r
# Create a static age-sex pyramid
age_sex_pyramid(
  dynamic = FALSE,
  params = list(
    df = lab_data,
    var_map = list(
      date_of_birth = 'date_of_birth',
      sex = 'sex'
    ),
    grouped = FALSE,
    colours = c("pink", "blue")
  )
)

# Convert to an interactive plotly chart by changing dynamic to TRUE
age_sex_pyramid(
  dynamic = TRUE,
  params = list(
    df = lab_data,
    var_map = list(
      date_of_birth = 'date_of_birth',
      sex = 'sex'
    ),
    grouped = FALSE,
    colours = c("pink", "blue")
  )
)
```
