<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>LLM-assisted epidemiological narrative • epiviz</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="LLM-assisted epidemiological narrative">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epiviz</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/age-sex-pyramid.html">Age-sex pyramids</a></li>
    <li><a class="dropdown-item" href="../articles/col-chart.html">Column charts</a></li>
    <li><a class="dropdown-item" href="../articles/epi-curve.html">Epidemic curves</a></li>
    <li><a class="dropdown-item" href="../articles/epi-map.html">Epidemiological maps</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting started with epiviz</a></li>
    <li><a class="dropdown-item" href="../articles/line-chart.html">Line charts</a></li>
    <li><a class="dropdown-item" href="../articles/llm-interpret.html">LLM-assisted epidemiological narrative</a></li>
    <li><a class="dropdown-item" href="../articles/point-chart.html">Point charts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ukhsa-collaboration/epiviz/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>LLM-assisted epidemiological narrative</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ukhsa-collaboration/epiviz/blob/HEAD/vignettes/llm-interpret.Rmd" class="external-link"><code>vignettes/llm-interpret.Rmd</code></a></small>
      <div class="d-none name"><code>llm-interpret.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code><a href="../reference/llm_interpret.html">llm_interpret()</a></code> function integrates Large Language
Model (LLM) capabilities to automatically interpret epidemiological
visualisations and data. This powerful feature can generate insights,
identify patterns, and provide contextual analysis of your charts and
datasets, making it valuable for surveillance reporting and data
exploration.</p>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ukhsa-collaboration/epiviz" class="external-link">epiviz</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="environment-setup">Environment Setup<a class="anchor" aria-label="anchor" href="#environment-setup"></a>
</h2>
<p>Before using <code><a href="../reference/llm_interpret.html">llm_interpret()</a></code>, set provider-agnostic
environment variables. These are what the function reads.</p>
<div class="section level3">
<h3 id="required-environment-variables">Required Environment Variables<a class="anchor" aria-label="anchor" href="#required-environment-variables"></a>
</h3>
<p>Set these in your <code>.Renviron</code> file or R session:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Provider: one of "openai", "gemini", or "anthropic"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>LLM_PROVIDER <span class="op">=</span> <span class="st">"openai"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># API key for the chosen provider</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>LLM_API_KEY <span class="op">=</span> <span class="st">"your-api-key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model for the chosen provider (examples)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>LLM_MODEL <span class="op">=</span> <span class="st">"gpt-4.1-nano"</span><span class="op">)</span>        <span class="co"># OpenAI</span></span>
<span><span class="co"># Sys.setenv(LLM_MODEL = "gemini-2.5-flash-lite")  # Google</span></span>
<span><span class="co"># Sys.setenv(LLM_MODEL = "claude-sonnet-4-20250514")          # Anthropic</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="verify-setup">Verify Setup<a class="anchor" aria-label="anchor" href="#verify-setup"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"LLM_PROVIDER"</span><span class="op">)</span> <span class="op">!=</span> <span class="st">""</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"LLM_API_KEY"</span><span class="op">)</span> <span class="op">!=</span> <span class="st">""</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"LLM_MODEL"</span><span class="op">)</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"LLM environment is configured\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Please set LLM_PROVIDER, LLM_API_KEY and LLM_MODEL\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-1-interpreting-an-epidemic-curve">Example 1: Interpreting an epidemic curve<a class="anchor" aria-label="anchor" href="#example-1-interpreting-an-epidemic-curve"></a>
</h2>
<p>This example demonstrates how to use LLM interpretation to analy#sze
an epidemic curve and generate insights about temporal patterns.</p>
<div class="section level3">
<h3 id="prepare-the-data-and-create-a-visualization">Prepare the data and create a visualization<a class="anchor" aria-label="anchor" href="#prepare-the-data-and-create-a-visualization"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create an epidemic curve for interpretation</span></span>
<span><span class="va">epi_data</span> <span class="op">&lt;-</span> <span class="fu">epiviz</span><span class="fu">::</span><span class="va"><a href="../reference/lab_data.html">lab_data</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">organism_species_name</span> <span class="op">==</span> <span class="st">"STAPHYLOCOCCUS AUREUS"</span>,</span>
<span>    <span class="va">specimen_date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span>,</span>
<span>    <span class="va">specimen_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-12-31"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the epidemic curve</span></span>
<span><span class="va">epi_curve_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epi_curve.html">epi_curve</a></span><span class="op">(</span></span>
<span>  dynamic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="va">epi_data</span>,</span>
<span>    date_var <span class="op">=</span> <span class="st">"specimen_date"</span>,</span>
<span>    date_start <span class="op">=</span> <span class="st">"2023-01-01"</span>,</span>
<span>    date_end <span class="op">=</span> <span class="st">"2023-12-31"</span>,</span>
<span>    time_period <span class="op">=</span> <span class="st">"year_month"</span>,</span>
<span>    fill_colours <span class="op">=</span> <span class="st">"#007C91"</span>,</span>
<span>    chart_title <span class="op">=</span> <span class="st">"Monthly Staph aureus detections (2023)"</span>,</span>
<span>    x_axis_title <span class="op">=</span> <span class="st">"Month"</span>,</span>
<span>    y_axis_title <span class="op">=</span> <span class="st">"Number of detections"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">epi_curve_plot</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpret-the-visualisation">Interpret the visualisation<a class="anchor" aria-label="anchor" href="#interpret-the-visualisation"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use LLM to interpret the epidemic curve</span></span>
<span><span class="va">interpretation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/llm_interpret.html">llm_interpret</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">epi_curve_plot</span>,</span>
<span>  word_limit <span class="op">=</span> <span class="fl">120</span>,</span>
<span>  prompt_extension <span class="op">=</span> <span class="st">"Analyse this epidemic curve and identify notable patterns, trends, or anomalies. Focus on seasonal patterns and potential outbreak periods."</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the interpretation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"LLM Interpretation:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">interpretation</span><span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>: The LLM will analyse the epidemic
curve and provide insights about temporal patterns, seasonal trends, and
any notable peaks or anomalies in the data.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-2-custom-interpretation-with-specific-focus">Example 2: Custom interpretation with specific focus<a class="anchor" aria-label="anchor" href="#example-2-custom-interpretation-with-specific-focus"></a>
</h2>
<p>This example shows how to provide a custom prompt to guide the LLM’s
analysis toward specific epidemiological concerns.</p>
<div class="section level3">
<h3 id="prepare-the-data-and-create-a-visualization-1">Prepare the data and create a visualization<a class="anchor" aria-label="anchor" href="#prepare-the-data-and-create-a-visualization-1"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create an age-sex pyramid for interpretation</span></span>
<span><span class="va">pyramid_data</span> <span class="op">&lt;-</span> <span class="fu">epiviz</span><span class="fu">::</span><span class="va"><a href="../reference/lab_data.html">lab_data</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">organism_species_name</span> <span class="op">==</span> <span class="st">"KLEBSIELLA PNEUMONIAE"</span>,</span>
<span>    <span class="va">specimen_date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span>,</span>
<span>    <span class="va">specimen_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-06-30"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the age-sex pyramid</span></span>
<span><span class="va">pyramid_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/age_sex_pyramid.html">age_sex_pyramid</a></span><span class="op">(</span></span>
<span>  dynamic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="va">pyramid_data</span>,</span>
<span>    var_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dob_var <span class="op">=</span> <span class="st">"date_of_birth"</span>, sex_var <span class="op">=</span> <span class="st">"sex"</span><span class="op">)</span>,</span>
<span>    grouped <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    mf_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#440154"</span>, <span class="st">"#2196F3"</span><span class="op">)</span>,</span>
<span>    x_axis_title <span class="op">=</span> <span class="st">"Number of cases"</span>,</span>
<span>    y_axis_title <span class="op">=</span> <span class="st">"Age group (years)"</span>,</span>
<span>    legend_title <span class="op">=</span> <span class="st">"Klebsiella pneumoniae cases by age and sex (H1 2023)"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pyramid_plot</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpret-with-custom-epidemiological-focus">Interpret with custom epidemiological focus<a class="anchor" aria-label="anchor" href="#interpret-with-custom-epidemiological-focus"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use LLM with a custom prompt focused on public health implications</span></span>
<span><span class="va">custom_interpretation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/llm_interpret.html">llm_interpret</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">pyramid_plot</span>,</span>
<span>  word_limit <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  prompt_extension <span class="op">=</span> <span class="st">"As a public health epidemiologist, analyze this age-sex pyramid for Klebsiella pneumoniae cases. Identify which demographic groups are most at risk, discuss potential risk factors, and suggest targeted prevention strategies. Consider healthcare-associated infections and community transmission patterns."</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the custom interpretation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Custom Epidemiological Analysis:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">custom_interpretation</span><span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>: The LLM will provide a detailed
epidemiological analysis focusing on risk groups, potential transmission
patterns, and public health recommendations based on the demographic
distribution shown in the pyramid.</p>
</div>
</div>
<div class="section level2">
<h2 id="tips-for-llm-interpretation">Tips for LLM interpretation<a class="anchor" aria-label="anchor" href="#tips-for-llm-interpretation"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>API Key Management</strong>:
<ul>
<li>Store API keys securely in your <code>.Renviron</code> file</li>
<li>Never commit API keys to version control</li>
<li>Use different keys for different environments (development,
production)</li>
</ul>
</li>
<li>
<strong>Prompt Engineering</strong>:
<ul>
<li>Be specific about what you want the LLM to focus on</li>
<li>Include context about the epidemiological scenario</li>
<li>Ask for actionable insights and recommendations</li>
<li>Specify the level of detail you need</li>
</ul>
</li>
<li>
<strong>Data Privacy</strong>:
<ul>
<li>Be cautious with sensitive health data</li>
<li>Consider using aggregated or anonymised data for LLM
interpretation</li>
<li>Review your organisation’s data sharing policies</li>
</ul>
</li>
<li>
<strong>Cost Management</strong>:
<ul>
<li>LLM API calls have costs based on usage</li>
<li>Start with smaller datasets for testing</li>
</ul>
</li>
<li>
<strong>Quality Control</strong>:
<ul>
<li>Always review LLM interpretations for accuracy</li>
<li>Cross-reference with domain expertise</li>
<li>Use LLM insights as a starting point for further analysis</li>
</ul>
</li>
<li>
<strong>Integration with Workflows</strong>:
<ul>
<li>Use LLM interpretation for automated report generation</li>
<li>Incorporate into surveillance dashboards</li>
<li>Generate insights for outbreak investigation</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<div class="section level3">
<h3 id="common-issues">Common Issues<a class="anchor" aria-label="anchor" href="#common-issues"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p><strong>API Key Not Found</strong>: Ensure your environment
variables are properly set and accessible to R.</p></li>
<li><p><strong>Rate Limiting</strong>: If you hit rate limits, implement
delays between requests or use different API keys.</p></li>
<li><p><strong>Model Not Available</strong>: Check that your specified
model is available in your API plan.</p></li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Harshana Liyanage, Alex Bhattacharya, James Duke, Liam Fitzpatrick, James Leatherland, Jordan Worth, Emma Parker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
